[gd_scene load_steps=2 format=3 uid="uid://dsy6xt2bk2eto"]

[sub_resource type="GDScript" id="GDScript_143yq"]
script/source = "extends CanvasLayer

@onready var score_container = $score_container

func show_leaderboard():
	# Clear old labels
	for child in score_container.get_children():
		child.queue_free()

	# Load leaderboard data
	var path = \"user://leaderboard.json\"
	var data: Array = []

	if FileAccess.file_exists(path):
		var file = FileAccess.open(path, FileAccess.READ)
		if file:
			var parsed = JSON.parse_string(file.get_as_text())
			if parsed is Array:
				data = parsed
			file.close()

	# Collect scores in an array
	var scores: Array = []
	for entry in data:
		scores.append(int(entry[\"orbs\"]))

	# Sort scores descending using a custom function
	scores.sort_custom(self, \"_compare_desc\")

	# Populate score labels
	for score in scores:
		var s_label = Label.new()
		s_label.text = str(score)

		# Alignment settings
		s_label.horizontal_alignment = HORIZONTAL_ALIGNMENT_CENTER
		s_label.size_flags_horizontal = Control.SIZE_FILL | Control.SIZE_EXPAND

		# Add label to score container
		score_container.add_child(s_label)

		# Debug print
		print(\"Score: \", score)


# Custom sort function for descending order
func _compare_desc(a, b) -> int:
	return b - a  # b comes before a for descending
"

[node name="leaderboard" type="CanvasLayer"]
layer = 2
script = SubResource("GDScript_143yq")

[node name="ColorRect" type="ColorRect" parent="."]
offset_left = -50.0
offset_right = 1179.0
offset_bottom = 655.0
color = Color(0, 0, 0, 1)

[node name="RichTextLabel" type="RichTextLabel" parent="."]
offset_left = 219.0
offset_top = 51.0
offset_right = 968.0
offset_bottom = 152.0
theme_override_font_sizes/normal_font_size = 70
bbcode_enabled = true
text = "[center]LEADERBOARD
"

[node name="close_button" type="Button" parent="."]
offset_left = 1092.0
offset_top = 6.0
offset_right = 1147.0
offset_bottom = 59.0
theme_override_font_sizes/font_size = 30
text = "X"

[node name="rank_container" type="VBoxContainer" parent="."]
offset_left = 336.0
offset_top = 170.0
offset_right = 384.0
offset_bottom = 635.0

[node name="rank_label" type="Label" parent="rank_container"]
layout_mode = 2
theme_override_font_sizes/font_size = 20
horizontal_alignment = 1

[node name="name_container" type="VBoxContainer" parent="."]
offset_left = 416.0
offset_top = 170.0
offset_right = 761.0
offset_bottom = 635.0

[node name="name_label" type="Label" parent="name_container"]
layout_mode = 2
theme_override_font_sizes/font_size = 20
horizontal_alignment = 1

[node name="score_container" type="VBoxContainer" parent="."]
offset_left = 770.0
offset_top = 170.0
offset_right = 884.0
offset_bottom = 635.0

[node name="score_label" type="Label" parent="score_container"]
layout_mode = 2
theme_override_font_sizes/font_size = 20
horizontal_alignment = 1
